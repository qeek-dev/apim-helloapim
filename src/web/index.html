<!DOCTYPE html>
<html>
<head><meta charset="utf-8">
<title> APIM example - helloqpkg </title>
<script type="text/javascript" src="//code.jquery.com/jquery-3.3.1.min.js"></script>
<script type="text/javascript" charset="utf-8">
    $(document).ready(function(){
        var input = document.getElementById("input");
        var ws;
        var port = '13000';
        var print = function(message) {
            s = (new Date()).toLocaleString()
            $('#log').append('<br>' + s + ' '+ message );
            window.scrollTo(0,document.body.scrollHeight);
        };

        $("#open").click(function(){
            if (ws) {
                return;
            }
            //port = location.port;
            ws = new WebSocket('ws://' + document.domain + ':' + port + '/v1/echo');
            ws.onopen = function(evt) {
                print("OPEN");
            }
            ws.onclose = function(evt) {
                print("CLOSE");
                ws = null;
            }
            ws.onmessage = function(evt) {
                print("RESPONSE: " + evt.data);
            }
            ws.onerror = function(evt) {
                print("ERROR: " + evt.data);
            }
            return;
        });

        $("#close").click(function() {
            if (!ws) {
                return;
            }
            ws.close();
        });

        $("#send").click(function(){
            if (!ws) {
                return;
            }
            print("SEND: " + input.value);
            ws.send(input.value);
        });

        $("#getPeople").click(function() {
            $.ajax({
                url: 'http://' + document.domain + ':' + port + '/v1/people/1',
                type: "GET",
                crossDomain: true,
                headers: {
                    'Content-Type': 'application/json',
                },
                success: function (data, status) {
                    print("Status: " + status + "\n");
                    print("ID: " + data.id + "\n");
                    print("Name: " + data.firstname + " " + data.lastname + "\n");
                },
                error: function (xhr, status) {
                    alert("error");
                }
            });
        });
    });

    function clog() {$('#log').empty();}
</script>
</head>
<body>
<h1>Hello QPKG API test page</h1>
<p>Click "Open" to create a connection to the websocket server, 
"Send" to send a message to the server and "Close" to close the connection. 
You can change the message and send multiple times.
<p>
<button id="open">Open</button>
<button id="close">Close</button>
<p><input id="input" type="text" value="Hello world!">
<button id="send">Send</button>
<p>Click "Get People" to get the people list by HTTP API from server
<p>
<button id="getPeople">Get First People</button>
<p></p>
<button onclick="clog()">Clear Message</button>
<div id="log"></div>
</body>
</html>